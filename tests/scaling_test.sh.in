#!/bin/bash

echo > scaling_test.output

./spamm_multiply >> scaling_test.output 2>&1

grep SpAMM_SCALING scaling_test.output | awk '{print $2, $4}' > scaling_test.dat

# Test result.
./parseTestResults.py --output scaling_test.output --reference scaling_test.reference
teststatus=$?
if test $teststatus -ne 0; then
  echo "product accuracy test failed"
fi

./parseTestResults.py --output scaling_test.output --reference @SCALING_REFERENCE@
teststatus=$?
if test $teststatus -ne 0; then
  echo "product timing test failed"
fi

exit $teststatus
